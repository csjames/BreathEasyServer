<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LifeGuide Toolbox Admin Page</title>

    <link rel="icon" type="image/png" href="/img/icon.png" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

</head>

<body>

    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">LifeGuide Toolbox <span class="glyphicon glyphicon-copyright-mark"></span></a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="#"><span class="glyphicon glyphicon-home"></span> Home</a></li>
                <li><a href="#about"><span class="glyphicon glyphicon-question-sign"></span> About</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="jumbotron text-center">
            <h2>LifeGuide Toolbox Management Page</h2>
        </div>

        <div class="jumbotron">

            <div class="container">
                <div id="loginbox" style="margin-top:10px;" class="mainbox col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
                    <form name="login" action="api/authenticate" method="post" accept-charset="utf-8">
                        <h2>Please enter your login information</h2>

                        <div class="form-group">
                            <label for="username" class="col-md-3 control-label">Username</label>
                            <input type="text" maxlength="40" name="username" placeholder="username" required>
                        </div>
                        <div class="form-group">
                            <label for="password" class="col-md-3 control-label">Password</label>
                            <input type="password" maxlength="40" name="password" placeholder="password" required>
                        </div>


                        <button type="submit" onclick="login()" class="btn btn-default btn-block">Login</button>
                        <input type="checkbox" value="remember-me" id="rememberMe" name="rememberMe"> Remember me

                    </form>
                    <div class="btn-group btn-group-justified">

                    </div>
                    <form name="forgotenpassword" action="api/users" method="get" accept-charset="utf-8">
                        <button type="submit" class="btn btn-default btn-block">Forgoten Password</button>
                    </form>
                    <form name="register" action="api/signup" method="post" accept-charset="utf-8">
                        <button type="submit" class="btn btn-default btn-block">Register</button>
                    </form>

                </div>
            </div>


        </div>

    </div>

    <script>
        (function () {

            var LOCAL_TOKEN_KEY = 'yourTokenKey';
            var username = '';
            var isAuthenticated = false;
            var role = '';
            var authToken;

            function validateForm() {
                var x = document.forms["login"]["username"].value;
                if (x == null || x == "") {
                    alert("Please fill out the username");
                    return false;
                }
            }

            function login(user) {
                return $q(function (resolve, reject) {
                    $http.post(API_ENDPOINT.url + '/authenticate', user).then(function (result) {
                        if (result.data.success) {
                            console.log("saving the token");
                            storeUserCredentials(result.data.token);
                            resolve(result.data.msg);
                        } else {
                            reject(result.data.msg);
                        }
                    });
                });
            }

            function storeUserCredentials(token) {
                window.localStorage.setItem(LOCAL_TOKEN_KEY, token);
                useCredentials(token);
            }

            function useCredentials(token) {
                username = token.split('.')[0];
                isAuthenticated = true;
                authToken = token;

                if (username == 'admin') {
                    role = USER_ROLES.admin
                }
                if (username == 'user') {
                    role = USER_ROLES.public
                }

                // Set the token as header for your requests!
                $http.defaults.headers.common['X-Auth-Token'] = token;
            }

            var logout = function () {
                destroyUserCredentials();
            };

            function destroyUserCredentials() {
                authToken = undefined;
                username = '';
                isAuthenticated = false;
                $http.defaults.headers.common['X-Auth-Token'] = undefined;
                window.localStorage.removeItem(LOCAL_TOKEN_KEY);
            }

            var isAuthorized = function (authorizedRoles) {
                if (!angular.isArray(authorizedRoles)) {
                    authorizedRoles = [authorizedRoles];
                }
                return (isAuthenticated && authorizedRoles.indexOf(role) !== -1);
            };

            function tokenManagement() {
                var token = window.localStorage.getItem('token');
                if (token) {
                    options.headers = {
                        'x-access-token': token
                    }
                }
            }
        }());
    </script>
</body>

</html>
